---
title: å®‰æ´µæ¯2023-wp
date: 2023-06-11 13:09:24
categories: 
- Reverse
tags: 
- Reverse
- CTF
---

# ez_cpp

## æ­£å‘é€»è¾‘ï¼š

```python
def reverse_bit(num, bit):
    result = 0
    for i in range(bit):
        result |= ((num >> i) & 1) << (bit - i - 1)
    return result
b = "SYC{xxxxxxxxxxxxxxxxxxxxxxxx}"
d = []
c = 0x1EF035
for i in range(len(b)):
    eax = (c & 0xFFFF00) + ord(b[i]) - 0x3D
    if eax & 0xFF < 0x3E:
        v7 = ord(b[i]) + 13
        if ord(b[i]) > 0x5A:
            if ord(b[i]) + 13 <= 0x7A:
                d.append(ord(b[i]) + 13)
            else:
                d.append(ord(b[i]) - 13)
        else:
            if ord(b[i]) + 13 <= 0x5A:
                d.append(ord(b[i]) + 13)
            else:
                d.append(ord(b[i]) - 13)
    else:
        d.append(ord(b[i]))
str2 = []
v6 = [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0]
for i in range(32):
    if i == 16:
        str2.append(d[i] ^ 4)
    elif i < 16:
        if v6[i] == 1:
            str2.append(d[i] ^ 9)
        else:
            str2.append(d[i] - 2)
    elif i > 16:
        if v6[i] == 1:
            str2.append(d[i] ^ 6)
        else:
            str2.append(d[i] - 5)
for i in range(32):
    str2[i] = 1 ^ (reverse_bit(str2[i], 8) + 1)
print("".join(hex(i)[2:] + " " for i in str2))
```

## é€†å‘é€»è¾‘

å…¶ä¸­ç¬¬ä¸€ä¸ªåŠ å¯†ç”¨å¯è§å­—ç¬¦è¾“å…¥å¾—åˆ°å¯è§å­—ç¬¦è¾“å‡ºæ¥é€†ï¼Œå› æ­¤å¯èƒ½äº§ç”Ÿä¸€ä¸ªå­—ç¬¦å¯¹åº”å¤šä¸ªï¼Œæ‰€ä»¥ç­›æŽ‰çœ‹ä¸ŠåŽ»ä¸åƒçš„å°±å¥½äº†ã€‚

```python
def reverse_bit(num, bit):
    result = 0
    for i in range(bit):
        result |= ((num >> i) & 1) << (bit - i - 1)
    return result
v6 = [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0]
result = [0x00000022, 0xFFFFFFA2, 0x00000072, 0xFFFFFFE6, 0x00000052, 0xFFFFFF8C, 0xFFFFFFF2, 0xFFFFFFD4, 0xFFFFFFA6,
          0x0000000A, 0x0000003C, 0x00000024, 0xFFFFFFA6, 0xFFFFFF9C, 0xFFFFFF86, 0x00000024, 0x00000042, 0xFFFFFFD4,
          0x00000022, 0xFFFFFFB6, 0x00000014, 0x00000042, 0xFFFFFFCE, 0xFFFFFFAC, 0x00000014, 0x0000006A, 0x0000002C,
          0x0000007C, 0xFFFFFFE4, 0xFFFFFFE4, 0xFFFFFFE4, 0x0000001E]
for i in range(32):
    result[i] = result[i] & 0xFF
for i in range(32):
    result[i] = reverse_bit((result[i] ^ 1) - 1, 8)
for i in range(32):
    if i == 16:
        result[i] ^= 4
    elif i < 16:
        if v6[i] == 1:
            result[i] ^= 9
        else:
            result[i] += 2
    else:
        if v6[i] == 1:
            result[i] ^= 6
        else:
            result[i] += 5
flag = []
c1 = [i for i in range(32, 128)]
c2 = [32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
      60, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74,
      75, 76, 77, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 97,
      98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 123, 124, 125, 126, 127]
for i in range(32):
    for j in range(len(c2)):
        if result[i] == c2[j]:
            flag.append(c1[j])
    flag.append(ord("\n"))
print("".join(chr(i) for i in flag))
# SYC{Y3S-yE5-y0u-S0Ve-Th3-C9P!!!}
```

## å…¶ä»–å¸ˆå‚…WPçš„æ€è·¯

å…·ä½“å¯çœ‹ ðŸ‘‰ [2023 å®‰æ´µæ¯SYCTF writeup by Arr3stY0u](https://mp.weixin.qq.com/s?__biz=Mzg4MjcxMTAwMQ==&mid=2247487028&idx=1&sn=4a73d839a64b6c1071c519ed2195aa25&chksm=cf53ce82f8244794da9dd9b9034709ee5e71d8b3931a75fd87ac31d450869f87411054ea3ed9&mpshare=1&scene=23&srcid=0611rfRKf6I8RnGhn24J0TzY&sharer_sharetime=1686452556948&sharer_shareid=6eea79ff6da57fc6752ab0bc570bf392#rd)

ç”±äºŽæ•´ä½“çš„åŠ å¯†è¿‡ç¨‹æ˜¯å•ä¸ªå­—ç¬¦çš„åŠ å¯†ï¼Œå› æ­¤å¯ä»¥é€šè¿‡çˆ†ç ´ä¸€ä¸ªä¸ªå­—ç¬¦æ¥å¾—åˆ°flagã€‚

æ–¹æ³•ï¼špatchæŽ‰éƒ¨åˆ†ä»£ç ï¼Œä½¿`exitcode`ä¸ºç¬¦åˆæ¡ä»¶çš„å­—ç¬¦æ•°ã€‚

åŽŸä»£ç ï¼š

![åŽŸä»£ç ](å®‰æ´µæ¯2023/image-20230611132142148.png)

patchåŽçš„ä»£ç ï¼š

![patchåŽçš„ä»£ç ](å®‰æ´µæ¯2023/image-20230611132025951.png)

çˆ†ç ´è„šæœ¬ï¼š

```python
import string
import os
import time
table = string.ascii_letters+string.digits+'!-{}'
theflag = ''
while len(theflag) < 32:
    for ch in table:
        flag = (theflag+ch).ljust(32, '#')
        exitcode = os.system(f"echo {flag} | ez_cpp.exe 1>&0")
        print("try: " + theflag + ch + " exitcode:" + hex(exitcode))
        if exitcode >= len(theflag) + 1:
            theflag += ch
            print(theflag, exitcode)
            break
    else:
        print(theflag + 'not found')
    time.sleep(0.1)
```

# 3D_Maze

äº†è§£é€»è¾‘ï¼ŒèŽ·å–è¿·å®«åŽæ‰‹åŠ¨èµ°èµ°ï¼ˆæ³¨æ„ï¼šzçš„é¡ºåºæ˜¯æœ‰è¦æ±‚çš„ï¼‰ï¼š

```python
maze = [
    0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0,
    0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 5, 0, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0,
    0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0,
    1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1,
    0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
]

for i in range(len(maze)):
    if i % 10 == 0:
        print()
    if i % 100 == 0:
        print("\nz="+ str(i//100))
    match maze[i]:
        case 0:
            print("=", end="")
        case 3:
            print("*", end="")
        case _:
            print(maze[i], end="")
# z=0
# ==1=======
# ==1====1==
# ==1=1111==
# ==1=1=====
# ==1=111111
# ==1=1=====
# ==11111111
# ==5=1=====
# ===*======
# ===1======
#
# wddwwdddddD
#
# z=1
# ==========
# =1111=====
# =1==111111
# =1========
# 11========
# ==========
# 11111=====
# ==========
# ==========
# ==========
#
# dwwwdddsdddddD
#
# z=2
# 1=========
# 1=========
# 1==1=1===1
# ==1=1=1=1=
# ==1====1==
# ===1===1==
# ====1==1==
# ==1=1==1==
# ===1===1==
# ==========
#
# wwW
#
# z=4
# ========11
# ========1=
# 111111111=
# ==========
# ==========
# ==========
# ==========
# ==========
# ==========
# ==========
#
# assaaaaaaaaA
#
# z=3
# ==1=======
# ==1=======
# ==1=11====
# ==11==1===
# ==11======
# ==11======
# ==11==1===
# ==1=11====
# ==1=======
# ==1=======
#
# sssssssssS
#
# z=5
# ===1======
# ===1======
# ===1======
# ===1======
# ===1======
# ==11======
# ==1=======
# 111=======
# ==========
# ==========
#
# dddwwdwwwwwW
# w
# wddwwdddddDdwwwdddsdddddDwwWassaaaaaaaaAsssssssssSddwwdwwwwwWw
```

# ezr3

## è„±å£³

åŠ äº†å£³ï¼Œä½†æ˜¯ç‰¹å¾ç è¢«è¦†ç›–äº†ï¼Œæ”¹å›žUPXï¼Œç„¶åŽè„±å£³ï¼š

![ç‰¹å¾ç 1](å®‰æ´µæ¯2023/image-20230611140348555.png)

![ç‰¹å¾ç 2](å®‰æ´µæ¯2023/image-20230611140524739.png)

![ç‰¹å¾ç 3](å®‰æ´µæ¯2023/image-20230611140408937.png)

å…¶ä¸­ â€˜#â€™ çš„æ•°æ®ï¼š

![â€˜#â€™ çš„æ•°æ®â€”â€”æ¥è‡ªå…¶ä»–ç”¨UPXåŠ å£³çš„ELF](å®‰æ´µæ¯2023/image-20230611140504793.png)

## ç¨‹åºé€»è¾‘

![ä¸»é€»è¾‘1](å®‰æ´µæ¯2023/image-20230611232914599.png)

![ä¸»é€»è¾‘2](å®‰æ´µæ¯2023/image-20230611232937745.png)

ä¸»è¦å‡½æ•°ä¸º`v(), p()`ã€‚

`v()`ï¼šæ›´æ”¹ä¸€äº›æ•°æ®ã€‚

![vå‡½æ•°](å®‰æ´µæ¯2023/image-20230611234030720.png)

`p()`ï¼šå¤„ç†è¾“å…¥ç„¶åŽæ¯”å¯¹ã€‚

* å¤„ç†è¾“å…¥ï¼š
  * `input[i] = (input[i] >> 4) || (input[i] << 4)`
  * `input[i] = input[i] ^ input[len(input) - i]`

![på‡½æ•°](å®‰æ´µæ¯2023/image-20230611234055600.png)

## è„šæœ¬

```python
auth32 = [
    0x0003BC69, 0x000D3FA0, 0x0003A94A, 0x00044AFF, 0x00045254, 0x0000CDD1,
    0x00001815, 0x00003B08, 0x00070868, 0x000C6560, 0x00065662, 0x000855C8,
    0x0000DCF6, 0x00004CE6, 0x0014EEC2, 0x0002CFD6, 0x00032766, 0x0014F6BA,
    0x00025E69, 0x0006A9A3, 0x00121EBD, 0x0005991C, 0x00050016, 0x00004A3D,
    0x00097485, 0x0008D0A0, 0x0003B916, 0x00054C58, 0x00096F94, 0x00010334,
    0x000DAD22, 0x0004B234, 0x0002FE96, 0x000F33CC, 0x0012C1E8, 0x00148F9E
]
data32 = [
    0x00000D21, 0x00000000, 0x0000009D, 0x00000000, 0x0000094B, 0x00000000, 0x000003C9, 0x00000000, 0x00000C3F,
    0x00000000, 0x000017E9, 0x00000000, 0x0000130E, 0x00000000, 0x00000088, 0x00000000, 0x00000486, 0x00000000,
    0x0000202F, 0x00000000, 0x00002230, 0x00000000, 0x000024B4, 0x00000000, 0x000008B1, 0x00000000, 0x00000A9F,
    0x00000000, 0x00001AD2, 0x00000000, 0x000023EB, 0x00000000, 0x00000C7E, 0x00000000, 0x0000042B, 0x00000000,
    0x000005BF, 0x00000000, 0x0000113C, 0x00000000, 0x00000449, 0x00000000, 0x00001751, 0x00000000, 0x00000ACE,
    0x00000000, 0x00001894, 0x00000000, 0x0000208A, 0x00000000, 0x00000E82, 0x00000000, 0x000006BD, 0x00000000,
    0x00000CEE, 0x00000000, 0x00002386, 0x00000000, 0x000013D4, 0x00000000, 0x00000111, 0x00000000, 0x00000D1C,
    0x00000000, 0x0000238E, 0x00000000, 0x00001759, 0x00000000, 0x0000012B, 0x00000000, 0x0000214D, 0x00000000
]
v2 = 0
for i in range(6):
    for j in range(6):
        auth32[i * 6 + j] ^= data32[v2 + 12 * j]
    v2 += 2
v2 = 0
flag = []
for i in range(6):
    for j in range(6):
        flag.append(auth32[i * 6 + j] // data32[v2 + j * 12])
    v2 += 2
for i in range(len(flag)):
    flag[len(flag) - 1 - i] ^= flag[i]
    flag[len(flag) - 1 - i] = (flag[len(flag) - 1 - i] >> 4) | (flag[len(flag) - 1 - i] << 4) & 0xFF
print(bytes(flag))
```



# snake

ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆï¼Œæ­»åŽä¼šç”Ÿæˆä¸€ä¸ªflagï¼Œåªæœ‰è›‡åˆ°361é•¿åº¦ç”Ÿæˆçš„flagæ‰æ˜¯çœŸçš„flagï¼ˆæ¯”èµ›çš„æ—¶å€™ä¸€ç›´ä¸çŸ¥é“è¿™é¢˜è¦å¹²å˜›ï¼‰ï¼Œçœ‹äº†å…¶ä»–å¸ˆå‚…çš„wpæ‰çŸ¥é“ã€‚

## ç¨‹åºä¸»é€»è¾‘

ç”±äºŽèŽ·å–flagçš„è¿‡ç¨‹ä¸Žæ¸¸æˆå…³ç³»ä¸å¤§ï¼Œæ‰€ä»¥æ¸¸æˆéƒ¨åˆ†é€»è¾‘ä¸é˜è¿°ã€‚

mainå‡½æ•°ä¸­ï¼Œåˆå§‹åŒ–è›‡ï¼Œèº«å­ç”¨é“¾è¡¨æ¥å®žçŽ°ï¼Œæ¯èŠ‚èº«å­æœ‰å®ƒçš„ä½ç½®xã€yä»¥åŠå…¶ä»–ä¿¡æ¯ã€‚

è›‡çš„èº«å­é•¿åº¦ä¸€å¼€å§‹ä¸º3ï¼Œå¯é€šè¿‡åŠ¨è°ƒå¾—åˆ°ã€‚

![åˆå§‹åŒ–è›‡](å®‰æ´µæ¯2023/image-20230611151313654.png)

èŽ·å–éšæœºæ•°åºåˆ—ï¼Œåœ¨ä¹‹åŽçš„æžœå®žç”Ÿæˆä»¥åŠåŠ å¯†ä¼šç”¨åˆ°ï¼š

![éšæœºæ•°åºåˆ—](å®‰æ´µæ¯2023/image-20230611151725890.png)

åœ¨ç¨‹åºæ¸¸æˆæ¯è½®çš„è¿›è¡Œä¸­ï¼Œéƒ½ä¼šæ›´æ–°åˆ†æ•°ä»¥åŠå…¶å®ƒç»†èŠ‚ï¼š

![æ¸¸æˆæ›´æ–°](å®‰æ´µæ¯2023/image-20230611152126183.png)

å½“è›‡åƒåˆ°æžœå®žæ—¶ï¼Œå°±ä¼šè¿›å…¥ifè¯­å¥ï¼Œæœ€åŽ`CxxThrowException`æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå…·ä½“å¤„ç†åœ¨æ±‡ç¼–ä»£ç å¤„å¯ä»¥çœ‹å‡ºï¼š

![å¤„ç†å¼‚å¸¸](å®‰æ´µæ¯2023/image-20230611152426840.png)

æŠ›å‡ºå¼‚å¸¸æ‰§è¡Œçš„åœ°æ–¹åº”è¯¥æ˜¯`0x401E92`å¤„ï¼Œå°†å‰é¢è·³åˆ°`0x401F92`çš„è·³è½¬æŒ‡ä»¤æ”¹æˆè·³è½¬è‡³`0x401E92`å¤„ï¼Œå¯ä»¥èŽ·å–åæ±‡ç¼–ä»£ç ï¼š

![è›‡åƒåˆ°æžœå®žçš„å¤„ç†](å®‰æ´µæ¯2023/image-20230611181440981.png)

1. ç¨‹åºæ›´æ–°æœ€åŽå°†ä¼šè¢«ç”Ÿæˆmd5çš„æ•°æ®ä¸ºç›®å‰çš„è›‡çš„å„èŠ‚ç‚¹çš„ç¬¬äº”ä¸ªæ•°æ®ã€‚

2. å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡RC4åŠ å¯†ã€‚

3. å€’è½¬è›‡èŠ‚ç‚¹çš„æ•°æ®ï¼Œå³å°†åŠ å¯†åŽçš„`will_be_md5`åè½¬æ”¾å…¥è›‡çš„èŠ‚ç‚¹ã€‚ï¼ˆ`dword_C1DEA4`çš„ä¸‹ä¸€ä¸ªåœ°å€å°±æ˜¯`will_be_md5`ï¼‰

4. æ–°å¢žä¸€ä¸ªè›‡èŠ‚ç‚¹`node`ï¼Œå…¶`node[5]`ä¸º`index_data`ï¼ŒåŒæ—¶æ›´æ–°`index_data`ï¼ˆæœ€å¼€å§‹ä¸º0x92ï¼‰ä¸º`(index_data - 1) ^ (final_node[5] - 1)`ï¼Œå…¶ä¸­final_nodeä¸ºè›‡æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬æ–°å¢žçš„ï¼‰ã€‚

æ–°çš„æžœå®žçš„ç”Ÿæˆï¼š

ç”±äºŽ`dowrd_4BDEA4`å½“è›‡åƒåˆ°æžœå®žæ—¶ä¸º0ï¼Œå› æ­¤å½“èµ°æžœå®žç”Ÿæˆçš„æ¡ä»¶åˆ†æ”¯æ—¶ï¼Œè›‡çš„ä½ç½®å’Œæžœå®žçš„ä½ç½®ä¸€å®šç›¸åŒï¼Œå› æ­¤ä¼šèµ°ç¬¬ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ï¼šç”±éšæœºæ•°åºåˆ—çš„ä¸€ä¸ªæ•°ä½œä¸ºç§å­æ¥ç”Ÿæˆæžœå®žä½ç½®ã€‚

![æžœå®žç”Ÿæˆ](å®‰æ´µæ¯2023/image-20230611170551372.png)

## RC4_for_dataçš„é€»è¾‘

æ•´ä½“æµç¨‹å°±æ˜¯RC4ã€‚

RC4çš„keyæ˜¯ä»¥è›‡çš„ä½ç½®ä½œä¸ºç§å­ï¼Œè¿žç»­ç”Ÿæˆçš„éšæœºæ•°ï¼Œè€Œç”±äºŽåªæœ‰è›‡åƒåˆ°æžœå®žæ‰èƒ½è¿›å…¥è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤ä¹Ÿæ˜¯æžœå®žçš„ä½ç½®ã€‚

![RC4åˆå§‹åŒ–](å®‰æ´µæ¯2023/image-20230611165503791.png)

å…ˆå°†RC4åŠ å¯†å¼‚æˆ–çš„å€¼å­˜å‚¨ä¸‹æ¥ï¼Œç„¶åŽåœ¨ä¸‹é¢å¼‚æˆ–æ•°æ®ï¼Œå¼‚æˆ–çš„å¤„ç†æ— è®ºèµ°å“ªä¸ªæ¡ä»¶åˆ†æ”¯éƒ½å°†æ•°æ®ä¸Žä¸Šé¢ä¿å­˜çš„å¼‚æˆ–æ•°æ®è¿›è¡Œå¼‚æˆ–ã€‚

![åŠ å¯†](å®‰æ´µæ¯2023/image-20230611163658407.png)

## flagç”Ÿæˆ

èŽ·å–æ•°æ®ï¼Œç”Ÿæˆmd5ï¼š

![flagç”Ÿæˆå‡½æ•°](å®‰æ´µæ¯2023/image-20230611164021052.png)

## è„šæœ¬

è´´ä¸€ä¸ªå…¶ä»–å¸ˆå‚…çš„è„šæœ¬ï¼š

```python

import ctypes
from Crypto.Cipher import ARC4
from hashlib import md5

libc = ctypes.CDLL("ucrtbase.dll")
libc.srand.argtypes = [ctypes.c_uint]
libc.rand.restype = ctypes.c_int

srand = libc.srand
rand = libc.rand

srand(0x94307F97)
seed_list = []
for i in range(361):
    seed_list.append(rand())


def enc(buf, size, seed):
    srand(seed)
    keysize = int(rand()*1.0/32767.0 * 256.0)
    table = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\x00'
    pwd = ''
    for i in range(keysize):
        idx = int(rand()*1.0 / 32767.0 * 63.0)
        pwd += table[idx]

    cipher = ARC4.ARC4Cipher(pwd.encode())
    xorstream = b'\x00'*size
    xorstream = cipher.encrypt(xorstream)
    outbuf = bytearray(buf)
    for i in range(size):
        outbuf[i] ^= xorstream[i]
    return bytes(outbuf)


foods = []
for i in range(361):
    srand(seed_list[i])
    while 1:
        y = rand() % 20
        x = rand() % 20
        if not (x == 0 or x == 19 or y == 0 or y == 19):
            # print(i, y, x)
            foods.append((y, x))
            break


tmp = 0x92

data = b'\x02'
for i in range(2):
    data += bytes([data[-1] ^ 0xBE])
# print(data.hex())

flag_data = data[:]
eat_count = 361 # åˆå§‹é•¿åº¦å°±æ˜¯3, ä½†æ˜¯è¦æ±‚åƒ361ä¸ª ???
for i in range(eat_count):
    y, x = foods[i]
    pos = y << 8 | x
    data = enc(data, 3+i, pos)
    # print(data.hex())

    _tmp = tmp
    # print(hex(tmp-1), hex(data[0]-1))
    tmp = ((tmp-1) ^ (data[0]-1)) & 0xFF
    flag_data = data[:]
    data = data[::-1]
    data += bytes([_tmp])
    # print(hex(tmp))

s = flag_data.ljust(361, b'\x00').hex().encode()
print('flag_data', len(flag_data))
print('SYC{'+md5(s[:722]).hexdigest()+'}')
```

# babyThread

## é€»è¾‘

æµç¨‹å¾ˆæ˜Žæ˜¾ï¼Œå°±æ˜¯åŠ å¯†å’Œæ¯”å¯¹ï¼Œä¸»è¦æ˜¯åˆ¤æ–­ç”Ÿæˆå¯†é’¥çš„å­—ç¬¦ä¸²æ˜¯å“ªä¸€ä¸ªã€‚

åŠ å¯†è¿‡ç¨‹ï¼š

![åŠ å¯†è¿‡ç¨‹](å®‰æ´µæ¯2023/image-20230611200355369.png)

ä¸»è¿‡ç¨‹ï¼š

![ä¸»è¿‡ç¨‹](å®‰æ´µæ¯2023/image-20230611200429997.png)

ä¸‰ä¸ªå¯†é’¥ï¼ˆä¸‰ä¸ªåªæœ‰ä¸€ä¸ªæ˜¯è¢«ç”¨åˆ°çš„ï¼‰ï¼š

1. ![ç¬¬ä¸€ä¸ªå¯†é’¥](å®‰æ´µæ¯2023/image-20230611200618444.png)
2. ![ç¬¬äºŒä¸ªå¯†é’¥](å®‰æ´µæ¯2023/image-20230611200531434.png)
3. ![ç¬¬ä¸‰ä¸ªå¯†é’¥](å®‰æ´µæ¯2023/image-20230611200559786.png)

æ‰€ä»¥ç›´æŽ¥ä¸‰ä¸ªéƒ½è¯•ä¸€ä¸‹ã€‚

## è„šæœ¬

```c
#include <stdio.h>
#include <string.h>
void rc4_init(unsigned char*key, unsigned long Len, unsigned char*s)
{
	int i = 0, j = 0;
	unsigned char k[256] = { 0 };
	unsigned char tmp = 0;
	for (i = 0; i<256; i++)
	{
		s[i] = i;
		k[i] = (unsigned char)key[i%Len];
	}
	for (i = 0; i<256; i++)
	{
        j = (j + s[i] + k[i]) % 256;
		tmp = s[i];
		s[i] = s[j];
		s[j] = tmp;
	}
}
void rc4_crypt(unsigned char*s, unsigned char*Data, unsigned long Len)
{
	int i = 0, j = 0, t = 0;
	unsigned long k = 0;
	unsigned char tmp;
	for (k = 0; k<Len; k++)
	{
		i = (i + 1) % 256;
		j = (j + s[i]) % 256;
		tmp = s[i];
		s[i] = s[j];
		s[j] = tmp;
		t = (s[i] + s[j]) % 256;
		Data[k] ^= s[t];
	}
}
int main()
{
    int v8[7];
    int i = 0, i_ = 0, j = 0, j_, t;
    int v4, v9;
    // char Str[100] = "FD,B0?YORg@:*VTCLnY4";
    // char Str[100] = "D..^!ARBIh@;K:dAU-K`";
    // char Str[100] = "!This_program_cannot";
    char Str[21];
    FILE * f = fopen("å®‰æ´µæ¯2023/babyThread.exe", "rb");
    fseek(f, 0x4D, 0);
    fread(Str, 1, 0x14, f);
    fclose(f);
    
    unsigned char key[24];
    v8[0] = 1;
    v8[1] = 85;
    v8[2] = 0x1C39;
    v8[3] = 0x95EED;
    v8[4] = 0x31C84B1;
    for (j = 0, i = 0; i < strlen(Str); j += 4, i += 5)
    {
        v9 = 0;
        for (t = 0; t < 5; ++t)
        {
            if (Str[t + i] == 'z')
                key[t + j] = 0;
            else
                v9 += v8[4 - t] * (Str[t + i] - 33);
        }
        key[j + 3] = (*((char *)&v9));
        key[j + 2] = (*((char *)&v9 + 1));
        key[j + 1] = (*((char *)&v9 + 2));
        key[j] = (*((char *)&v9 + 3));
    }
    unsigned char data[32] = {
        0xDE, 0x1C, 0x22, 0x27, 0x1D, 0xAE, 0xAD, 0x65, 0xAD, 0xEF, 
        0x6E, 0x41, 0x4C, 0x34, 0x75, 0xF1, 0x16, 0x50, 0x50, 0xD4, 
        0x48, 0x69, 0x6D, 0x93, 0x36, 0x1C, 0x86, 0x3B, 0xBB, 0xD0, 
        0x4C, 0x91
    };
    char s[264];
    rc4_init(key, 16, s);
    rc4_crypt(s, data, 32);
    for(i = 0; i<32 ; i++){
        printf("%c", data[i]);
    }
    return 0;
}
```

# gowhere

ç”¨IDAGolangè„šæœ¬è¿˜åŽŸç¬¦å·ã€å‡½æ•°åç§°ã€‚

å¤§æ¦‚çš„é€»è¾‘æ˜¯è¾“å…¥30ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œè¿›è¡Œä¸‰è½®ä¸‰ä¸ªå‡½æ•°åŠ å¯†ç„¶åŽä¸Žå¯†æ–‡æ¯”å¯¹ã€‚

## å‡½æ•°ä¸€é€»è¾‘

é€»è¾‘ï¼š`input = (input + enc1_key) ^ 0x17`

![åŠ å¯†ä¸€](å®‰æ´µæ¯2023/image-20230611210036323.png)

ä¸»è¦æ˜¯å¯»æ‰¾`enc1_key`çš„å˜åŒ–ã€‚

`enc_key1`åˆå§‹ä¸º9ã€‚

æ¯æ¬¡è¿›å…¥`main_enc1()`æ—¶ï¼Œ`enc_key1`ä¼šåŠ ä¸€ï¼š

![enc_key1å˜åŒ–](å®‰æ´µæ¯2023/image-20230611210240590.png)

æ¯æ¬¡è¿›å…¥`main_enc2()`æ—¶ï¼Œ`enc_key1`ä¹Ÿä¼šåŠ ä¸€ï¼š

![enc_key1å˜åŒ–](å®‰æ´µæ¯2023/image-20230611210358258.png)

æ¯æ¬¡è¿›å…¥`main_enc3()`æ—¶ï¼Œ`enc_key1`ä¹Ÿä¼šåŠ ä¸€ï¼š

![enc_key1å˜åŒ–](å®‰æ´µæ¯2023/image-20230611210443173.png)

## å‡½æ•°äºŒé€»è¾‘

![å‡½æ•°äºŒ](å®‰æ´µæ¯2023/image-20230611210608263.png)

## å‡½æ•°ä¸‰é€»è¾‘

![å‡½æ•°ä¸‰](å®‰æ´µæ¯2023/image-20230611211829162.png)

## ä¸»é€»è¾‘

ä¸‰ä¸ªåŠ å¯†çš„ä»£ç ç‰‡æ®µéƒ½å¼„æ‡‚äº†ï¼Œä½†è°ƒç”¨çš„é¡ºåºå´æ²¡æœ‰ï¼Œç¨‹åºçš„å…·ä½“é€»è¾‘æˆ‘è¿˜æ²¡æœ‰å¼„æ‡‚ã€‚

åˆ†åˆ«ä¸ºä¸‰ä¸ªåŠ å¯†çš„ä»£ç ç‰‡æ®µèµ°è¿‡ä¸”æ¯æ¬¡åŠ å¯†åªèµ°ä¸€æ¬¡çš„ä»£ç ä¸‹æ¡ä»¶æ–­ç‚¹ï¼Œæ‰“å°ä¸€äº›ä¿¡æ¯ï¼š

![æ–­ç‚¹ä¿¡æ¯](å®‰æ´µæ¯2023/image-20230611215638395.png)

å¯ä»¥çŸ¥æ™“åŠ å¯†æµç¨‹ï¼šenc1-2-3-2-3-1-2-3-2-3

## è„šæœ¬

```python
def dec1(data, key):
    for i in range(len(data)):
        data[i] = (data[i] ^ 0x17) - key
    return data


def dec2(input):
    input[0] -= 2
    input[1] += 28
    input[2] ^= 0x47
    input[3] -= input[4]
    input[5] -= 73
    input[6] -= 12
    input[8] ^= 0x5A
    input[7] += input[8]
    input[9] ^= 0x22
    input[10] -= 20
    input[12] += 84
    input[13] ^= 4
    input[14] ^= 0x1C
    input[17] += 1
    input[27] ^= 0x11
    input[28] ^= 3
    for i in range(len(input)):
        input[i] &= 0xff
    return input


def dec3(data):
    for i in range(len(data) // 2):
        data[i], data[29-i] = data[29-i], data[i]
    return data


flag = [
    0x4D, 0x63, 0x5D, 0x34, 0x43, 0x09, 0xA2, 0x77, 0x0A, 0xBF,
    0xC9, 0xB3, 0xE9, 0x6F, 0x79, 0x7D, 0x7B, 0xE8, 0x99, 0x90,
    0x43, 0x08, 0xBB, 0x99, 0x0E, 0x2E, 0xD4, 0x7B, 0x27, 0xB7,
]

flag = dec3(flag)
flag = dec2(flag)
flag = dec3(flag)
flag = dec2(flag)
flag = dec1(flag, 16)
flag = dec3(flag)
flag = dec2(flag)
flag = dec3(flag)
flag = dec2(flag)
flag = dec1(flag, 10)
print(flag)
print("".join(chr(i) for i in flag))
```



